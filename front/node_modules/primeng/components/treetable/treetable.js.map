{"version":3,"file":"treetable.js","sourceRoot":"","sources":["treetable.ts"],"names":[],"mappings":";;;;;;;;;;;;;AAAA,qBAA+I,eAAe,CAAC,CAAA;AAC/J,uBAA2B,iBAAiB,CAAC,CAAA;AAE7C,uBAAmC,kBAAkB,CAAC,CAAA;AACtD,uBAA2B,kBAAkB,CAAC,CAAA;AAyB9C;IAQI,mBAAwD,SAAmB;QAAnB,cAAS,GAAT,SAAS,CAAU;QAJlE,UAAK,GAAW,CAAC,CAAC;IAImD,CAAC;IAE/E,0BAAM,GAAN,UAAO,KAAY;QACf,EAAE,CAAA,CAAC,IAAI,CAAC,IAAI,CAAC,QAAQ,CAAC;YAClB,IAAI,CAAC,SAAS,CAAC,cAAc,CAAC,IAAI,CAAC,EAAC,aAAa,EAAE,KAAK,EAAE,IAAI,EAAE,IAAI,CAAC,IAAI,EAAC,CAAC,CAAC;QAChF,IAAI;YACA,IAAI,CAAC,SAAS,CAAC,YAAY,CAAC,IAAI,CAAC,EAAC,aAAa,EAAE,KAAK,EAAE,IAAI,EAAE,IAAI,CAAC,IAAI,EAAC,CAAC,CAAC;QAE9E,IAAI,CAAC,IAAI,CAAC,QAAQ,GAAG,CAAC,IAAI,CAAC,IAAI,CAAC,QAAQ,CAAC;IAC7C,CAAC;IAED,0BAAM,GAAN;QACI,MAAM,CAAC,IAAI,CAAC,IAAI,CAAC,IAAI,IAAI,KAAK,GAAG,KAAK,GAAG,CAAC,CAAC,IAAI,CAAC,IAAI,CAAC,QAAQ,IAAE,IAAI,CAAC,IAAI,CAAC,QAAQ,CAAC,MAAM,CAAC,CAAC;IAC9F,CAAC;IAED,8BAAU,GAAV;QACI,MAAM,CAAC,IAAI,CAAC,SAAS,CAAC,UAAU,CAAC,IAAI,CAAC,IAAI,CAAC,CAAC;IAChD,CAAC;IAED,8BAAU,GAAV,UAAW,KAAiB;QACxB,IAAI,CAAC,SAAS,CAAC,UAAU,CAAC,KAAK,EAAE,IAAI,CAAC,IAAI,CAAC,CAAC;IAChD,CAAC;IAED,oCAAgB,GAAhB,UAAiB,IAAS,EAAE,KAAa;QACrC,EAAE,CAAA,CAAC,IAAI,IAAI,KAAK,CAAC,CAAC,CAAC;YACf,EAAE,CAAA,CAAC,KAAK,CAAC,OAAO,CAAC,GAAG,CAAC,IAAI,CAAC,CAAC,CAAC,CAAC,CAAC;gBAC1B,MAAM,CAAC,IAAI,CAAC,KAAK,CAAC,CAAC;YACvB,CAAC;YACD,IAAI,CAAC,CAAC;gBACF,IAAI,MAAM,GAAa,KAAK,CAAC,KAAK,CAAC,GAAG,CAAC,CAAC;gBACxC,IAAI,KAAK,GAAG,IAAI,CAAC;gBACjB,GAAG,CAAA,CAAC,IAAI,CAAC,GAAG,CAAC,EAAE,GAAG,GAAG,MAAM,CAAC,MAAM,EAAE,CAAC,GAAG,GAAG,EAAE,EAAE,CAAC,EAAE,CAAC;oBAC/C,KAAK,GAAG,KAAK,CAAC,MAAM,CAAC,CAAC,CAAC,CAAC,CAAC;gBAC7B,CAAC;gBACD,MAAM,CAAC,KAAK,CAAC;YACjB,CAAC;QACL,CAAC;QACD,IAAI,CAAC,CAAC;YACF,MAAM,CAAC,IAAI,CAAC;QAChB,CAAC;IACL,CAAC;IA9CD;QAAC,YAAK,EAAE;;2CAAA;IAER;QAAC,YAAK,EAAE;;4CAAA;IA1BZ;QAAC,gBAAS,CAAC;YACP,QAAQ,EAAE,YAAY;YACtB,QAAQ,EAAE,23CAkBT;SACJ,CAAC;mBASe,aAAM,CAAC,iBAAU,CAAC,cAAM,OAAA,SAAS,EAAT,CAAS,CAAC,CAAC;;iBATlD;IAkDF,gBAAC;AAAD,CAAC,AAjDD,IAiDC;AAjDY,iBAAS,YAiDrB,CAAA;AAyCD;IAAA;QAQc,oBAAe,GAAsB,IAAI,mBAAY,EAAE,CAAC;QAExD,iBAAY,GAAsB,IAAI,mBAAY,EAAE,CAAC;QAErD,mBAAc,GAAsB,IAAI,mBAAY,EAAE,CAAC;QAEvD,iBAAY,GAAsB,IAAI,mBAAY,EAAE,CAAC;QAErD,mBAAc,GAAsB,IAAI,mBAAY,EAAE,CAAC;IA2FrE,CAAC;IA/EG,8BAAU,GAAV,UAAW,KAAiB,EAAE,IAAc;QACxC,IAAI,WAAW,GAAc,KAAK,CAAC,MAAO,CAAC;QAC3C,EAAE,CAAA,CAAC,WAAW,CAAC,SAAS,IAAI,WAAW,CAAC,SAAS,CAAC,OAAO,CAAC,sBAAsB,CAAC,KAAK,CAAC,CAAC,CAAC,CAAC;YACtF,MAAM,CAAC;QACX,CAAC;QACD,IAAI,CAAC,CAAC;YACF,IAAI,OAAO,GAAG,CAAC,KAAK,CAAC,OAAO,IAAE,KAAK,CAAC,OAAO,CAAC,CAAC;YAC7C,IAAI,KAAK,GAAG,IAAI,CAAC,oBAAoB,CAAC,IAAI,CAAC,CAAC;YAC5C,IAAI,QAAQ,GAAG,CAAC,KAAK,IAAI,CAAC,CAAC,CAAC;YAE5B,EAAE,CAAA,CAAC,QAAQ,IAAI,OAAO,CAAC,CAAC,CAAC;gBACrB,EAAE,CAAA,CAAC,IAAI,CAAC,qBAAqB,EAAE,CAAC,CAAC,CAAC;oBAC9B,IAAI,CAAC,eAAe,CAAC,IAAI,CAAC,IAAI,CAAC,CAAC;gBACpC,CAAC;gBACD,IAAI,CAAC,CAAC;oBACF,IAAI,CAAC,SAAS,CAAC,MAAM,CAAC,KAAK,EAAC,CAAC,CAAC,CAAC;oBAC/B,IAAI,CAAC,eAAe,CAAC,IAAI,CAAC,IAAI,CAAC,SAAS,CAAC,CAAC;gBAC9C,CAAC;gBAED,IAAI,CAAC,cAAc,CAAC,IAAI,CAAC,EAAC,aAAa,EAAE,KAAK,EAAE,IAAI,EAAE,IAAI,EAAC,CAAC,CAAC;YACjE,CAAC;YACD,IAAI,CAAC,CAAC;gBACF,EAAE,CAAA,CAAC,IAAI,CAAC,qBAAqB,EAAE,CAAC,CAAC,CAAC;oBAC9B,IAAI,CAAC,eAAe,CAAC,IAAI,CAAC,IAAI,CAAC,CAAC;gBACpC,CAAC;gBACD,IAAI,CAAC,EAAE,CAAA,CAAC,IAAI,CAAC,uBAAuB,EAAE,CAAC,CAAC,CAAC;oBACrC,IAAI,CAAC,SAAS,GAAG,CAAC,CAAC,OAAO,CAAC,GAAG,EAAE,GAAG,IAAI,CAAC,SAAS,IAAE,EAAE,CAAC;oBACtD,IAAI,CAAC,SAAS,CAAC,IAAI,CAAC,IAAI,CAAC,CAAC;oBAC1B,IAAI,CAAC,eAAe,CAAC,IAAI,CAAC,IAAI,CAAC,SAAS,CAAC,CAAC;gBAC9C,CAAC;gBAED,IAAI,CAAC,YAAY,CAAC,IAAI,CAAC,EAAC,aAAa,EAAE,KAAK,EAAE,IAAI,EAAE,IAAI,EAAC,CAAC,CAAC;YAC/D,CAAC;QACL,CAAC;IACL,CAAC;IAED,wCAAoB,GAApB,UAAqB,IAAc;QAC/B,IAAI,KAAK,GAAW,CAAC,CAAC,CAAC;QAEvB,EAAE,CAAA,CAAC,IAAI,CAAC,aAAa,IAAI,IAAI,CAAC,SAAS,CAAC,CAAC,CAAC;YACtC,EAAE,CAAA,CAAC,IAAI,CAAC,qBAAqB,EAAE,CAAC,CAAC,CAAC;gBAC9B,KAAK,GAAG,CAAC,IAAI,CAAC,SAAS,IAAI,IAAI,CAAC,GAAG,CAAC,GAAG,CAAE,CAAC,CAAC;YAC/C,CAAC;YACD,IAAI,CAAC,EAAE,CAAA,CAAC,IAAI,CAAC,uBAAuB,EAAE,CAAC,CAAC,CAAC;gBACrC,GAAG,CAAA,CAAC,IAAI,CAAC,GAAG,CAAC,EAAE,CAAC,GAAI,IAAI,CAAC,SAAS,CAAC,MAAM,EAAE,CAAC,EAAE,EAAE,CAAC;oBAC7C,EAAE,CAAA,CAAC,IAAI,CAAC,SAAS,CAAC,CAAC,CAAC,IAAI,IAAI,CAAC,CAAC,CAAC;wBAC3B,KAAK,GAAG,CAAC,CAAC;wBACV,KAAK,CAAC;oBACV,CAAC;gBACL,CAAC;YACL,CAAC;QACL,CAAC;QAED,MAAM,CAAC,KAAK,CAAC;IACjB,CAAC;IAED,8BAAU,GAAV,UAAW,IAAc;QACrB,MAAM,CAAC,IAAI,CAAC,oBAAoB,CAAC,IAAI,CAAC,IAAI,CAAC,CAAC,CAAC;IACjD,CAAC;IAED,yCAAqB,GAArB;QACI,MAAM,CAAC,IAAI,CAAC,aAAa,IAAI,IAAI,CAAC,aAAa,IAAI,QAAQ,CAAC;IAChE,CAAC;IAED,2CAAuB,GAAvB;QACI,MAAM,CAAC,IAAI,CAAC,aAAa,IAAI,IAAI,CAAC,aAAa,IAAI,UAAU,CAAC;IAClE,CAAC;IAED,6BAAS,GAAT;QACI,EAAE,CAAA,CAAC,IAAI,CAAC,OAAO,CAAC,CAAC,CAAC;YACd,IAAI,UAAU,GAAG,IAAI,CAAC,OAAO,CAAC,OAAO,EAAE,CAAC;YACxC,GAAG,CAAA,CAAC,IAAI,CAAC,GAAG,CAAC,EAAE,CAAC,GAAG,UAAU,CAAC,MAAM,EAAE,CAAC,EAAE,EAAE,CAAC;gBACxC,EAAE,CAAA,CAAC,UAAU,CAAC,CAAC,CAAC,CAAC,MAAM,CAAC,CAAC,CAAC;oBACtB,MAAM,CAAC,IAAI,CAAC;gBAChB,CAAC;YACL,CAAC;QACL,CAAC;QACD,MAAM,CAAC,KAAK,CAAC;IACjB,CAAC;IAxGD;QAAC,YAAK,EAAE;;4CAAA;IAER;QAAC,YAAK,EAAE;;oDAAA;IAER;QAAC,YAAK,EAAE;;gDAAA;IAER;QAAC,aAAM,EAAE;;sDAAA;IAET;QAAC,aAAM,EAAE;;mDAAA;IAET;QAAC,aAAM,EAAE;;qDAAA;IAET;QAAC,aAAM,EAAE;;mDAAA;IAET;QAAC,aAAM,EAAE;;qDAAA;IAET;QAAC,YAAK,EAAE;;4CAAA;IAER;QAAC,YAAK,EAAE;;iDAAA;IAER;QAAC,mBAAY,CAAC,eAAM,CAAC;;6CAAA;IAErB;QAAC,mBAAY,CAAC,eAAM,CAAC;;6CAAA;IAErB;QAAC,sBAAe,CAAC,eAAM,CAAC;;8CAAA;IAjE5B;QAAC,gBAAS,CAAC;YACP,QAAQ,EAAE,aAAa;YACvB,QAAQ,EAAE,ioEAmCT;SACJ,CAAC;;iBAAA;IA4GF,gBAAC;AAAD,CAAC,AA3GD,IA2GC;AA3GY,iBAAS,YA2GrB,CAAA;AAOD;IAAA;IAA+B,CAAC;IALhC;QAAC,eAAQ,CAAC;YACN,OAAO,EAAE,CAAC,qBAAY,EAAC,qBAAY,CAAC;YACpC,OAAO,EAAE,CAAC,SAAS,EAAC,qBAAY,CAAC;YACjC,YAAY,EAAE,CAAC,SAAS,EAAC,SAAS,CAAC;SACtC,CAAC;;uBAAA;IAC6B,sBAAC;AAAD,CAAC,AAAhC,IAAgC;AAAnB,uBAAe,kBAAI,CAAA","sourcesContent":["import {NgModule,Component,Input,Output,EventEmitter,ElementRef,ContentChild,IterableDiffers,ContentChildren,QueryList,Inject,forwardRef} from '@angular/core';\nimport {CommonModule} from '@angular/common';\nimport {TreeNode} from '../common/api';\nimport {Header,Footer,Column} from '../common/shared';\nimport {SharedModule} from '../common/shared';\nimport {DomHandler} from '../dom/domhandler';\n\n@Component({\n    selector: '[pTreeRow]',\n    template: `\n        <div class=\"ui-treetable-row\" [ngClass]=\"{'ui-state-hover':hover&&treeTable.selectionMode,'ui-state-highlight':isSelected()}\">\n            <td *ngFor=\"let col of treeTable.columns; let i=index\" [ngStyle]=\"col.style\" [class]=\"col.styleClass\"\n                (mouseenter)=\"hover=true\" (mouseleave)=\"hover=false\" (click)=\"onRowClick($event)\">\n                <span *ngIf=\"i==0\" class=\"ui-treetable-toggler fa fa-fw ui-c\" [ngClass]=\"{'fa-caret-down':node.expanded,'fa-caret-right':!node.expanded}\"\n                    [ngStyle]=\"{'margin-left':level*16 + 'px','visibility': isLeaf() ? 'hidden' : 'visible'}\"\n                    (click)=\"toggle($event)\"></span>\n                <span *ngIf=\"!col.template\">{{resolveFieldData(node.data,col.field)}}</span>\n                <p-columnBodyTemplateLoader [column]=\"col\" [rowData]=\"node\" *ngIf=\"col.template\"></p-columnBodyTemplateLoader>\n            </td>\n        </div>\n        <div *ngIf=\"node.children && node.expanded\" class=\"ui-treetable-row\" style=\"display:table-row\">\n            <td [attr.colspan]=\"treeTable.columns.length\" class=\"ui-treetable-child-table-container\">\n                <table>\n                    <tbody pTreeRow *ngFor=\"let childNode of node.children\" [node]=\"childNode\" [level]=\"level+1\"></tbody>\n                </table>\n            </td>\n        </div>\n    `\n})\nexport class UITreeRow {\n\n    @Input() node: TreeNode;\n    \n    @Input() level: number = 0;\n            \n    public hover: boolean;\n    \n    constructor(@Inject(forwardRef(() => TreeTable)) public treeTable:TreeTable) {}\n    \n    toggle(event: Event) {\n        if(this.node.expanded)\n            this.treeTable.onNodeCollapse.emit({originalEvent: event, node: this.node});\n        else\n            this.treeTable.onNodeExpand.emit({originalEvent: event, node: this.node});\n            \n        this.node.expanded = !this.node.expanded;\n    }\n    \n    isLeaf() {\n        return this.node.leaf == false ? false : !(this.node.children&&this.node.children.length);\n    }\n    \n    isSelected() {\n        return this.treeTable.isSelected(this.node);\n    }\n    \n    onRowClick(event: MouseEvent) {\n        this.treeTable.onRowClick(event, this.node);\n    }\n    \n    resolveFieldData(data: any, field: string): any {\n        if(data && field) {\n            if(field.indexOf('.') == -1) {\n                return data[field];\n            }\n            else {\n                let fields: string[] = field.split('.');\n                let value = data;\n                for(var i = 0, len = fields.length; i < len; ++i) {\n                    value = value[fields[i]];\n                }\n                return value;\n            }\n        }\n        else {\n            return null;\n        }\n    }\n}\n\n@Component({\n    selector: 'p-treeTable',\n    template: `\n        <div [ngClass]=\"'ui-treetable ui-widget'\" [ngStyle]=\"style\" [class]=\"styleClass\">\n            <div class=\"ui-treetable-header ui-widget-header\" *ngIf=\"header\">\n                <ng-content select=\"header\"></ng-content>\n            </div>\n            <div class=\"ui-treetable-tablewrapper\">\n                <table class=\"ui-widget-content\">\n                    <thead>\n                        <tr class=\"ui-state-default\">\n                            <th #headerCell *ngFor=\"let col of columns\" [ngStyle]=\"col.style\" [class]=\"col.styleClass\" \n                                [ngClass]=\"'ui-state-default ui-unselectable-text'\">\n                                <span class=\"ui-column-title\" *ngIf=\"!col.headerTemplate\">{{col.header}}</span>\n                                <span class=\"ui-column-title\" *ngIf=\"col.headerTemplate\">\n                                    <p-columnHeaderTemplateLoader [column]=\"col\"></p-columnHeaderTemplateLoader>\n                                </span>\n                            </th>\n                        </tr>\n                    </thead>\n                    <tfoot *ngIf=\"hasFooter()\">\n                        <tr>\n                            <td *ngFor=\"let col of columns\" [ngStyle]=\"col.style\" [class]=\"col.styleClass\" [ngClass]=\"{'ui-state-default':true}\">\n                                <span class=\"ui-column-footer\" *ngIf=\"!col.footerTemplate\">{{col.footer}}</span>\n                                <span class=\"ui-column-footer\" *ngIf=\"col.footerTemplate\">\n                                    <p-columnFooterTemplateLoader [column]=\"col\"></p-columnFooterTemplateLoader>\n                                </span>\n                            </td>\n                        </tr>\n                    </tfoot>\n                    <tbody pTreeRow *ngFor=\"let node of value\" [node]=\"node\" [level]=\"0\"></tbody>\n                </table>\n            </div>\n            <div class=\"ui-treetable-footer ui-widget-header\" *ngIf=\"footer\">\n                <ng-content select=\"footer\"></ng-content>\n            </div>\n        </div>\n    `\n})\nexport class TreeTable {\n\n    @Input() value: TreeNode[];\n        \n    @Input() selectionMode: string;\n    \n    @Input() selection: any;\n    \n    @Output() selectionChange: EventEmitter<any> = new EventEmitter();\n    \n    @Output() onNodeSelect: EventEmitter<any> = new EventEmitter();\n    \n    @Output() onNodeUnselect: EventEmitter<any> = new EventEmitter();\n    \n    @Output() onNodeExpand: EventEmitter<any> = new EventEmitter();\n    \n    @Output() onNodeCollapse: EventEmitter<any> = new EventEmitter();\n    \n    @Input() style: any;\n        \n    @Input() styleClass: string;\n    \n    @ContentChild(Header) header: Header;\n\n    @ContentChild(Footer) footer: Footer;\n    \n    @ContentChildren(Column) columns: QueryList<Column>;\n        \n    onRowClick(event: MouseEvent, node: TreeNode) {\n        let eventTarget = (<Element> event.target);\n        if(eventTarget.className && eventTarget.className.indexOf('ui-treetable-toggler') === 0) {\n            return;\n        }\n        else {\n            let metaKey = (event.metaKey||event.ctrlKey);\n            let index = this.findIndexInSelection(node);\n            let selected = (index >= 0);\n                   \n            if(selected && metaKey) {\n                if(this.isSingleSelectionMode()) {\n                    this.selectionChange.emit(null);\n                }\n                else {\n                    this.selection.splice(index,1);\n                    this.selectionChange.emit(this.selection);\n                }\n\n                this.onNodeUnselect.emit({originalEvent: event, node: node});\n            }\n            else {\n                if(this.isSingleSelectionMode()) {\n                    this.selectionChange.emit(node);\n                }\n                else if(this.isMultipleSelectionMode()) {\n                    this.selection = (!metaKey) ? [] : this.selection||[];\n                    this.selection.push(node);\n                    this.selectionChange.emit(this.selection);\n                }\n\n                this.onNodeSelect.emit({originalEvent: event, node: node});\n            }\n        }\n    }\n    \n    findIndexInSelection(node: TreeNode) {\n        let index: number = -1;\n\n        if(this.selectionMode && this.selection) {\n            if(this.isSingleSelectionMode()) {\n                index = (this.selection == node) ? 0 : - 1;\n            }\n            else if(this.isMultipleSelectionMode()) {\n                for(let i = 0; i  < this.selection.length; i++) {\n                    if(this.selection[i] == node) {\n                        index = i;\n                        break;\n                    }\n                }\n            }\n        }\n\n        return index;\n    }\n    \n    isSelected(node: TreeNode) {\n        return this.findIndexInSelection(node) != -1;         \n    }\n    \n    isSingleSelectionMode() {\n        return this.selectionMode && this.selectionMode == 'single';\n    }\n    \n    isMultipleSelectionMode() {\n        return this.selectionMode && this.selectionMode == 'multiple';\n    }\n    \n    hasFooter() {\n        if(this.columns) {\n            let columnsArr = this.columns.toArray();\n            for(let i = 0; i < columnsArr.length; i++) {\n                if(columnsArr[i].footer) {\n                    return true;\n                }\n            }\n        }\n        return false;\n    }\n}\n\n@NgModule({\n    imports: [CommonModule,SharedModule],\n    exports: [TreeTable,SharedModule],\n    declarations: [TreeTable,UITreeRow]\n})\nexport class TreeTableModule { }"]}